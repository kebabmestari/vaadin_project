-- MySQL Script generated by MySQL Workbench
-- pe  4. marraskuuta 2016 23.10.27
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema wordSystem
-- -----------------------------------------------------
-- Database for online word training system for Vaadin course.
DROP SCHEMA IF EXISTS `wordSystem` ;

-- -----------------------------------------------------
-- Schema wordSystem
--
-- Database for online word training system for Vaadin course.
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `wordSystem` DEFAULT CHARACTER SET utf8 ;
USE `wordSystem` ;

-- -----------------------------------------------------
-- Table `wordSystem`.`user`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`user` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`user` (
  `idUser` INT NOT NULL AUTO_INCREMENT COMMENT 'User id',
  `date` DATE NOT NULL,
  `passwd` VARCHAR(255) NOT NULL,
  `name` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`idUser`))
ENGINE = InnoDB
COMMENT = 'Table representing the user of the system';


-- -----------------------------------------------------
-- Table `wordSystem`.`language`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`language` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`language` (
  `idLanguage` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`idLanguage`))
ENGINE = InnoDB
COMMENT = 'Table which represents a language in the system which words can be referenced to.';


-- -----------------------------------------------------
-- Table `wordSystem`.`word`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`word` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`word` (
  `idWord` INT NOT NULL AUTO_INCREMENT,
  `idLang` INT NOT NULL,
  `word` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`idWord`),
  INDEX `fk_language_idx` (`idLang` ASC),
  CONSTRAINT `fk_language`
    FOREIGN KEY (`idLang`)
    REFERENCES `wordSystem`.`language` (`idLanguage`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'The table which represents a word in the dictionary. A word can be of any language and it\'s linked to it\'s explanation/master word in Finnish.';


-- -----------------------------------------------------
-- Table `wordSystem`.`list`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`list` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`list` (
  `idList` INT NOT NULL AUTO_INCREMENT,
  `creator` INT NOT NULL,
  `name` VARCHAR(255) NULL DEFAULT 'unnamedList',
  `maxPoints` INT NULL DEFAULT 10,
  PRIMARY KEY (`idList`),
  INDEX `fk_creator_idx` (`creator` ASC),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC),
  CONSTRAINT `fk_creator`
    FOREIGN KEY (`creator`)
    REFERENCES `wordSystem`.`user` (`idUser`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'List which is a composition of word entries which the user can train with.';


-- -----------------------------------------------------
-- Table `wordSystem`.`wordEntry`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`wordEntry` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`wordEntry` (
  `idWord` INT NOT NULL,
  `idList` INT NOT NULL,
  PRIMARY KEY (`idWord`, `idList`),
  INDEX `fk_list_idx` (`idList` ASC),
  CONSTRAINT `fk_list`
    FOREIGN KEY (`idList`)
    REFERENCES `wordSystem`.`list` (`idList`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_word`
    FOREIGN KEY (`idWord`)
    REFERENCES `wordSystem`.`word` (`idWord`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'Word entry in a list, relation between word and a list';


-- -----------------------------------------------------
-- Table `wordSystem`.`result`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`result` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`result` (
  `idResult` INT NOT NULL AUTO_INCREMENT,
  `date` DATETIME NOT NULL,
  `idUser` INT NOT NULL,
  `score` INT NULL DEFAULT 0,
  `idList` INT NOT NULL,
  `playTime` INT NULL DEFAULT -1,
  PRIMARY KEY (`idResult`),
  INDEX `fk_user_idx` (`idUser` ASC),
  INDEX `fk_list_idx` (`idList` ASC),
  CONSTRAINT `fk_list`
    FOREIGN KEY (`idList`)
    REFERENCES `wordSystem`.`list` (`idList`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_user`
    FOREIGN KEY (`idUser`)
    REFERENCES `wordSystem`.`user` (`idUser`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'A result from a single run of the game, used for tracking user\'s progress';


-- -----------------------------------------------------
-- Table `wordSystem`.`wordExplanation`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `wordSystem`.`wordExplanation` ;

CREATE TABLE IF NOT EXISTS `wordSystem`.`wordExplanation` (
  `idWord` INT NOT NULL,
  `idMaster` INT NOT NULL,
  PRIMARY KEY (`idWord`, `idMaster`),
  INDEX `fk_wordExplanation_2_idx` (`idMaster` ASC),
  CONSTRAINT `fk_wordExplanation_1`
    FOREIGN KEY (`idWord`)
    REFERENCES `wordSystem`.`word` (`idWord`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_wordExplanation_2`
    FOREIGN KEY (`idMaster`)
    REFERENCES `wordSystem`.`word` (`idWord`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

SET SQL_MODE = '';
GRANT USAGE ON *.* TO unitTester;
 DROP USER unitTester;
SET SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';
CREATE USER 'unitTester' IDENTIFIED BY 'kebab';

GRANT UPDATE, SELECT, INSERT, DELETE ON TABLE wordSystem.* TO 'unitTester';
SET SQL_MODE = '';
GRANT USAGE ON *.* TO webUser;
 DROP USER webUser;
SET SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';
CREATE USER 'webUser' IDENTIFIED BY 'rullakebab';

GRANT SELECT, INSERT, UPDATE ON TABLE wordSystem.* TO 'webUser';

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
